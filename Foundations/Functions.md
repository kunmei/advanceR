### 函数
函数是R中基础结构单元:为了掌握本书中许多更加高级的技术，你需要对函数是如何工作有很好的基础。你可能已经创建了很多R的函数，并且熟悉它们是如何工作的基础。本章节的目的就是将你对函数已经存在的，不正式的理解转变成对函数是什么以及它们是如何工作的严格的理解。在本章节，你将看到一些有趣的技巧和技术，但是你想要学习的将会更加重要，因为它们是更加高级技术的基础。

理解R最重要的事情就是R中的函数本身就是一个对象。你可以同操作任何其他类型的对象一样去操作函数。这个主题将在functional programming函数式编程中详细的介绍。

##### 纲要
- 函数组成 描述一个函数三个主要的组成部分
- 词法域 教你R中如何通过名字找到值，词法域的过程
- 每个操作是一个函数调用 说明R中发生的每一件事都是一个函数调用的结果，即使看起来不像
- 函数参数 讨论了三种方式给函数提供参数，如何给一个参数列表取调用函数，以及延迟计算的影响
- 特殊的调用 描述了函数的两种特殊类型:中缀和替换函数
- 返回值 讨论了函数如何以及何时返回值，以及在函数退出时一个函数是如何运行的

##### 预备知识
仅仅需要pryr包，用来探索当修改向量的时候将发生什么。

#### 函数组成部分
所有R函数有三个部分:
- 函数体body()， 函数内部的代码
- 函数形参formals()， 参数列表，控制你将如何调用函数
- 环境environment()， 函数变量位置

当你在R中打印函数的时候，会显示这三个重要的成分。如果环境没有显示，意味着函数是在全局环境中创建的。

```
f <- function(x) x^2
f
#> function(x) x^2

formals(f)
#> $x
body(f)
#> x^2
environment(f)
#> <environment: R_GlobalEnv>
```
body(), formals(), and environment()的赋值形式也可以用来修改函数。

像R中所有的对象一样，函数也可以持有任意数目的额外的属性。在base R中使用的一个属性是"srcref"，source reference的简称，指向创建函数的源代码。不像body()，它包括代码注释和其他格式。你还可以为函数增加属性。举个例子，你可以设置class()和增加一个常用的print()方法。

##### 原语函数
函数有三个组成部分的规则存在一个例外。原语函数，例如sum()，直接用.Primitive() 调用C代码，而且不包含R代码。因此它们的formals(), body(), and environment()都是NULL。

```
sum
#> function (..., na.rm = FALSE)  .Primitive("sum")
formals(sum)
#> NULL
body(sum)
#> NULL
environment(sum)
#> NULL
```
原语函数只会在base包里面发现。因为它们在底层操作，它们是非常高效的（原语替代函数不需要做复制），并且针对参数匹配有不同的规则（比如switch和call）。然而，你会造成和R中所有其他函数的行为不同。因此R core团队一般会避免取创建它们，除非必须要使用它们。

#### 词法作用域
Scoping作用域是R中管理如何查看一个符号所对应值的规则集合。在下面的例子中显示了R从符号x到它的值10的作用域的规则。

```
x <- 10
x
#> [1] 10
```
理解作用域可以让你:
- 通过组合函数构建工具，将会在函数编程中介绍
- 否决通常的求值计算规则，做非标准的求值，将会在 non-standard evaluation介绍

R中有两种类型的作用域:词法作用域，在语言层面自动实现，另一个是动态作用域，在动态交互的时候用于选择函数去保存类型。在这里，我们讨论词法作用域，因为它和函数创建密切相关。动态作用域将会在
scoping issues里面具体描述。




